<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance | Elite UA Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Orbitron:wght@700&family=Press+Start+2P&family=Bungee+Shade&family=Kelly+Slab&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #FFD700; --green: #2ecc71; --red: #e74c3c; --blue: #3498db; --pink: #fd79a8;
            --bg: #020202;
        }

        /* –°–ö–†–û–õ–ë–ê–† */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, transparent, var(--gold), transparent); border-radius: 10px; border: 2px solid #000; }

        body { background: var(--bg); color: white; font-family: 'Montserrat', sans-serif; margin: 0; width: 100%; overflow-x: hidden; }
        .background-scene { position: fixed; inset: 0; background: url('https://wallpaperaccess.com/full/240212.jpg') center/cover no-repeat; z-index: -2; filter: brightness(0.12); }
        #snow-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 1002; }

        header { 
            display: flex; justify-content: space-between; align-items: center; padding: 0 50px; height: 90px; position: fixed; width: 100%; top: 0; z-index: 1000; 
            background: rgba(0,0,0,0.9); border-bottom: 3px solid var(--gold); backdrop-filter: blur(20px); box-sizing: border-box;
        }

        .btn-fancy { 
            background: linear-gradient(135deg, #111, #000); border: 1px solid var(--gold); padding: 12px 24px; cursor: pointer; color: var(--gold); 
            font-weight: 900; border-radius: 4px; transition: 0.3s; font-size: 11px; text-transform: uppercase;
        }
        .btn-fancy:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px var(--gold); transform: scale(1.05); }

        .role-tag { 
            padding: 7px 15px; border-radius: 6px; font-size: 10px; font-weight: 900; text-transform: uppercase; margin: 4px; display: inline-block;
            position: relative; overflow: hidden; border: 1px solid rgba(255,255,255,0.15);
        }
        .role-tag::after { content: ''; position: absolute; top: -50%; left: -100%; width: 60px; height: 200%; background: rgba(255,255,255,0.3); transform: rotate(25deg); animation: reflection 3.5s infinite; }
        @keyframes reflection { 0% { left: -150%; } 100% { left: 250%; } }

        .r-founder { background: linear-gradient(45deg, #b30000, #ff0000); }
        .r-subfounder { background: linear-gradient(45deg, #ff8c00, #ffaa00); }
        .r-admin { background: linear-gradient(45deg, #0033aa, #0066ff); }
        .r-judge { background: linear-gradient(45deg, #2c3e50, #4ca1af); }
        .r-citizen { background: #333; color: #aaa; }

        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding: 40px; max-width: 1500px; margin: 0 auto; }
        .player-card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.05); border-radius: 25px; padding: 30px; display: flex; align-items: center; gap: 20px; transition: 0.4s; backdrop-filter: blur(10px); }
        .player-card:hover { border-color: var(--gold); transform: translateY(-10px); }
        .player-card img { width: 80px; height: 80px; border-radius: 15px; border: 2px solid var(--gold); }

        .status-banner { width: 100%; padding: 10px; border-radius: 8px; text-align: center; font-weight: 900; font-size: 10px; text-transform: uppercase; margin-bottom: 15px; }
        .sb-need { background: #222; color: #777; }
        .sb-review { background: var(--pink); color: #fff; }
        .sb-ok { background: var(--green); color: #fff; }
        .sb-no { background: var(--red); color: #fff; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .modal-content { background: #0a0a0a; padding: 45px; border: 2px solid #222; border-radius: 35px; width: 700px; max-height: 85vh; overflow-y: auto; position: relative; }
        .modal-full { max-width: 950px; height: 85vh; display: flex; flex-direction: column; }

        input, textarea, select { width: 100%; padding: 16px; margin: 12px 0; background: #111; border: 1px solid #333; color: #fff; border-radius: 12px; font-family: inherit; box-sizing: border-box; }
        
        .nick-glow { text-shadow: 0 0 15px var(--gold); }
        .font-pixel { font-family: 'Press Start 2P'; font-size: 11px !important; }
        .font-neon { font-family: 'Orbitron'; color: #fff; text-shadow: 0 0 10px var(--gold); }
        .font-magic { font-family: 'Bungee Shade'; color: var(--gold); }
        .font-ancient { font-family: 'Kelly Slab'; letter-spacing: 2px; }
        /* –ê–î–ê–ü–¢–ò–í –î–õ–Ø –¢–ï–õ–ï–§–û–ù–Ü–í */
        @media screen and (max-width: 1199px) {
            body { min-width: 100vw; }
            header { 
                height: auto; 
                padding: 15px; 
                flex-direction: column; 
                position: relative; 
                gap: 15px;
            }
            header div:last-child { 
                flex-wrap: wrap; 
                justify-content: center; 
                gap: 10px; 
            }
            .btn-fancy { padding: 8px 15px; font-size: 10px; }
            main { padding-top: 50px !important; }
            main h1 { font-size: 45px !important; }
            .modal-content { width: 90% !important; padding: 20px !important; }
            .staff-grid { grid-template-columns: 1fr !important; padding: 10px !important; }
            .player-card { padding: 15px !important; }
            .modal-full { height: 95vh !important; }
        }
        /* –ü–û–í–ï–†–¢–ê–Ñ–ú–û –®–ò–†–ò–ù–£ –î–õ–Ø –ü–ö */
        @media screen and (min-width: 1200px) {
            body { min-width: 1200px; }
        }
    </style>
</head>
<body onclick="playMusic()">

    <canvas id="snow-canvas"></canvas>
    <div class="background-scene"></div>
    <audio id="bg-music" loop><source src="https://raw.githubusercontent.com/More58-ai/NPU/main/Wham!%20-%20Last%20Christmas%20(Official%20Video).mp3" type="audio/mpeg"></audio>

<header>
        <div style="display:flex; align-items:center; gap:20px;">
            <img src="https://i.postimg.cc/7YtjW6Px/logo-al'ans.jpg" style="height:55px; border-radius:50%; border:2px solid var(--gold);">
            <div style="font-family:'Orbitron'; font-size: 26px; color: var(--gold); letter-spacing: 4px;">ALLIANCE UA</div>
        </div>
        <div style="display:flex; gap: 20px;">
            <button class="btn-fancy" style="border-color: #00ff00; color: #00ff00;" onclick="toggleModal('m-donate', true)">üíé –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏</button>
            
            <button class="btn-fancy" id="adm-pending-btn" style="display:none;" onclick="toggleModal('m-pending', true)">üì© –ó–∞—è–≤–∫–∏</button>
            
            <button class="btn-fancy" onclick="toggleModal('m-justice-main', true)">‚öñÔ∏è –°—É–¥</button>
            <button class="btn-fancy" onclick="toggleModal('m-players', true)">üë• –†–µ—î—Å—Ç—Ä</button>
            <button class="btn-fancy" onclick="toggleModal('m-profile', true)">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
        </div>
    </header>

    <main style="padding-top: 180px; text-align: center;">
        <h1 class="font-neon" style="font-size: 90px; margin: 0;">ALLIANCE UA</h1>
        <div style="max-width: 1000px; margin: 40px auto; background: rgba(0,0,0,0.7); padding: 50px; border-radius: 35px; border: 1px solid rgba(255,215,0,0.1); backdrop-filter: blur(15px); text-align: left;">
            <h2 style="color:var(--gold); font-family: 'Orbitron';">–°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–Ü–ù–ù–Ø</h2>
            <p>–í—ñ—Ç–∞—î–º–æ –≤ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–º—É –ø–æ—Ä—Ç–∞–ª—ñ –ê–ª—å—è–Ω—Å—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º–µ–Ω—é –∑–≤–µ—Ä—Ö—É –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—î—Å—Ç—Ä—ñ–≤ —Ç–∞ —Å—É–¥–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏.</p>
        </div>
    </main>

    <div id="m-donate" class="modal">
        <div class="modal-content" style="text-align: center;">
            <h2 class="font-neon" style="color: var(--gold);">–î–Ø–ö–£–Ñ–ú–û –ó–ê –ü–Ü–î–¢–†–ò–ú–ö–£!</h2>
            <p style="margin: 25px 0;">–í–∞—à—ñ –¥–æ–Ω–∞—Ç–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –ê–ª—å—è–Ω—Å—É —Ä–æ–∑–≤–∏–≤–∞—Ç–∏—Å—è.</p>
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button class="btn-fancy" style="background: #e67e22; color: #fff;" onclick="window.open('https://send.monobank.ua/jar/7sr4MKasrR', '_blank')">üè¶ MONOBANK –ë–∞–Ω–∫–∞</button>
                <button class="btn-fancy" style="border-color: var(--blue); color: var(--blue);" onclick="toggleModal('m-card-info', true)">üí≥ –ù–æ–º–µ—Ä –ö–∞—Ä—Ç–∏(monobank)</button>
            </div>
            <p onclick="toggleModal('m-donate', false)" style="margin-top:30px; cursor:pointer; opacity:0.3;">–ó–ê–ö–†–ò–¢–ò</p>
        </div>
    </div>

    <div id="m-card-info" class="modal" style="z-index: 6000;">
        <div class="modal-content" style="width: 450px; text-align: center; border-color: var(--blue);">
            <h3 class="font-neon">–ù–û–ú–ï–† –ö–ê–†–¢–ö–ò</h3>
            <div style="background: #111; padding: 20px; border-radius: 15px; border: 1px dashed var(--gold); color: var(--gold); margin: 20px 0; cursor: pointer;" onclick="copyCard()">
                4874 1000 2443 5797
            </div>
            <button class="btn-fancy" onclick="toggleModal('m-card-info', false)">–ù–ê–ó–ê–î</button>
        </div>
    </div>
    
    <div id="m-justice-main" class="modal">
        <div class="modal-content">
            <h2 class="font-neon" style="text-align:center;">–°–£–î–û–í–ê –°–ò–°–¢–ï–ú–ê</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin:25px 0;">
                <button class="btn-fancy" id="btn-adm-global" style="display:none; border-color:var(--pink);" onclick="openGlobalAdmin()">üìÅ –ü–ê–ù–ï–õ–¨ –°–£–î–î–Ü</button>
                <button class="btn-fancy" style="border-color:var(--green);" onclick="openMyReports()">üìÇ –ú–û–á –ó–ê–Ø–í–ò</button>
            </div>
            <div style="background: #111; padding: 20px; border-radius: 20px;">
                <input id="rep-target" placeholder="–ù—ñ–∫–Ω–µ–π–º –ø–æ—Ä—É—à–Ω–∏–∫–∞">
                <input id="rep-discord" placeholder="–í–∞—à Discord">
                <textarea id="rep-desc" placeholder="–û–ø–∏—Å —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—É..." rows="4"></textarea>
                <input id="rep-proof" placeholder="–î–æ–∫–∞–∑–∏ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è)">
                <button class="btn-fancy" style="width:100%; border-color:var(--green);" onclick="submitReport()">–ü–û–î–ê–¢–ò –°–ö–ê–†–ì–£</button>
            </div>
            <p onclick="toggleModal('m-justice-main', false)" style="margin-top:20px; cursor:pointer; opacity:0.3; text-align:center;">–ó–ê–ö–†–ò–¢–ò</p>
        </div>
    </div>

    <div id="m-global-admin" class="modal"><div class="modal-content modal-full">
        <h2 class="font-neon" style="text-align:center;">–ö–ï–†–£–í–ê–ù–ù–Ø –ü–†–ê–í–û–°–£–î–î–Ø–ú</h2>
        <div style="display:flex; justify-content:center; gap:10px; margin-bottom:25px;">
            <button class="btn-fancy" onclick="renderGlobal('need')">–ù–û–í–Ü</button>
            <button class="btn-fancy" onclick="renderGlobal('review')">–†–û–ó–ì–õ–Ø–î</button>
            <button class="btn-fancy" onclick="renderGlobal('archive')">–ê–†–•–Ü–í</button>
        </div>
        <div id="global-render-cont" style="flex-grow:1; overflow-y:auto;"></div>
        <button class="btn-fancy" style="margin-top:20px;" onclick="toggleModal('m-global-admin', false)">–ó–ê–ö–†–ò–¢–ò</button>
    </div></div>

    <div id="m-my-reports" class="modal"><div class="modal-content modal-full">
        <h2 class="font-neon" style="text-align:center;">–í–ê–®–Ü –°–ö–ê–†–ì–ò</h2>
        <div id="my-render-cont" style="flex-grow:1; overflow-y:auto;"></div>
        <button class="btn-fancy" style="margin-top:20px;" onclick="toggleModal('m-my-reports', false)">–ù–ê–ó–ê–î</button>
    </div></div>

    <div id="m-players" class="modal" style="align-items: flex-start; overflow-y: auto;">
        <div style="width:100%; padding: 130px 0;">
            <h2 class="font-neon" style="text-align:center; font-size: 50px;">–†–ï–Ñ–°–¢–† –ú–ï–®–ö–ê–ù–¶–Ü–í</h2>
            <div id="staff-render-box" class="staff-grid"></div>
            <button class="btn-fancy" style="display:block; margin: 40px auto;" onclick="toggleModal('m-players', false)">–ó–ê–ö–†–ò–¢–ò</button>
        </div>
    </div>

    <div id="m-profile" class="modal">
        <div class="modal-content" style="text-align:center;">
            <img id="p-ava" src="" style="width:160px; height:160px; border-radius:35px; border:4px solid var(--gold);">
            <h2 id="p-nick" class="nick-glow" style="font-size: 38px; margin: 25px 0;">–ù—ñ–∫</h2>
            <div id="p-roles" style="margin-bottom: 30px;"></div>
            
            <div id="p-admin-tools" style="display:none; margin-top:20px; border-top:1px solid #222; padding-top:20px; text-align:left;">
                <input id="adm-target-nick" placeholder="–ù—ñ–∫ –≥—Ä–∞–≤—Ü—è">
                <select id="adm-role-val">
                    <option value="citizen">–ú–µ—à–∫–∞–Ω–µ—Ü—å</option>
                    <option value="judge">–°—É–¥–¥—è</option>
                    <option value="admin">–ê–¥–º—ñ–Ω</option>
                    <option value="subfounder">–ó–∞—Å—Ç—É–ø–Ω–∏–∫</option>
                    <option value="founder">–ó–∞—Å–Ω–æ–≤–Ω–∏–∫</option>
                </select>
                <button class="btn-fancy" style="width:100%;" onclick="window.setRole()">–í–°–¢–ê–ù–û–í–ò–¢–ò –†–û–õ–¨</button>
            </div>
            <select onchange="window.updateFont(this.value)" style="margin-top:20px;">
                <option value="font-default">–®—Ä–∏—Ñ—Ç: Default</option>
                <option value="font-pixel">Pixel</option>
                <option value="font-neon">Neon</option>
                <option value="font-magic">Magic</option>
            </select>
            <button class="btn-fancy" style="width:100%; margin-top:20px; border-color:var(--red); color:var(--red);" onclick="window.logout()">–í–ò–ô–¢–ò</button>
            <p onclick="toggleModal('m-profile', false)" style="margin-top:20px; cursor:pointer; opacity:0.3;">–ó–ê–ö–†–ò–¢–ò –ü–†–û–§–Ü–õ–¨</p>
        </div>
    </div>

    <div id="auth-screen" style="position:fixed; inset:0; background:#000; z-index:9999; display:flex; align-items:center; justify-content:center;">
        <div class="modal-content" style="width: 450px; border-color: var(--green);">
            <div id="auth-box">
                <h2 class="font-neon" style="color:var(--green); text-align:center;">ALLIANCE UA</h2>
                <input id="u-n" placeholder="–ù—ñ–∫–Ω–µ–π–º">
                <input id="u-p" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
                <button class="btn-fancy" style="width:100%; margin-top:10px;" onclick="window.login()">–£–í–Ü–ô–¢–ò</button>
                <button class="btn-fancy" style="width:100%; margin-top:10px; border-color:var(--gold);" onclick="window.register()">–°–¢–í–û–†–¢–ò –ê–ö–ê–£–ù–¢</button>
            </div>
            <div id="auth-wait" style="display:none; text-align:center;">
                <h2 class="font-neon" style="color:var(--gold);">–ó–ê–Ø–í–ö–ê –í –†–û–ë–û–¢–Ü</h2>
                <p>–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–æ–∑–≥—è–¥—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞—á–µ–∫–∞–π—Ç–µ.</p>
                <button class="btn-fancy" onclick="location.reload()">–ü–ï–†–ï–í–Ü–†–ò–¢–ò –°–¢–ê–¢–£–°</button>
            </div>
            <div id="auth-denied" style="display:none; text-align:center;">
                <h2 class="font-neon" style="color:var(--red);">–í–Ü–î–ú–û–í–õ–ï–ù–û</h2>
                <p id="denied-msg" style="color:var(--red); font-weight:700;"></p>
                <button class="btn-fancy" onclick="clearDenied()">–ü–û–í–ï–†–ù–£–¢–ò–°–Ø</button>
            </div>
        </div>
    </div>

    <div id="m-pending" class="modal">
        <div class="modal-content">
            <h2 class="font-neon">–ù–û–í–Ü –ó–ê–Ø–í–ö–ò</h2>
            <div id="pending-list-render"></div>
            <button class="btn-fancy" style="width:100%; margin-top:30px;" onclick="toggleModal('m-pending', false)">–ó–ê–ö–†–ò–¢–ò</button>
        </div>
    </div>

<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, get, update, push, remove } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJjAJeJ7LApDyJbHypetzLNFuwIuAiD2Q",
            authDomain: "aliance-e277d.firebaseapp.com",
            projectId: "aliance-e277d",
            databaseURL: "https://aliance-e277d-default-rtdb.firebaseio.com/"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const curUser = localStorage.getItem('mc_user');

        const R_MAP = {
            founder: { n: "–ó–∞—Å–Ω–æ–≤–Ω–∏–∫ –ê–ª—å—è–Ω—Å—É", c: "r-founder", p: 100 },
            subfounder: { n: "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ó–∞—Å–Ω–æ–≤–Ω–∏–∫–∞ –ê–ª—å—è–Ω—Å—É", c: "r-subfounder", p: 90 },
            admin: { n: "–ê–¥–º—ñ–Ω", c: "r-admin", p: 80 },
            judge: { n: "–°—É–¥–¥—è", c: "r-judge", p: 70 },
            citizen: { n: "–ú–µ—à–∫–∞–Ω–µ—Ü—å", c: "r-citizen", p: 10 }
        };

        const STATS = { need: "–û–ß–Ü–ö–£–Ñ", review: "–ù–ê –†–û–ó–ì–õ–Ø–î–Ü", ok: "–°–•–í–ê–õ–ï–ù–û", no: "–í–Ü–î–•–ò–õ–ï–ù–û" };
        const S_CLASSES = { need: "sb-need", review: "sb-review", ok: "sb-ok", no: "sb-no" };

       window.toggleModal = (id, s) => document.getElementById(id).style.display = s ? 'flex' : 'none';
        
        window.copyCard = () => {
            navigator.clipboard.writeText('4874100024435797');
            alert('–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!');
        };

        window.register = async () => {
            const n = document.getElementById('u-n').value.trim(), p = document.getElementById('u-p').value.trim();
            if(!n || !p) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è!");
            await set(ref(db, 'pending_users/'+n), { nickname: n, password: p, status: 'waiting' });
            localStorage.setItem('waiting_nick', n);
            location.reload();
        };

        window.login = async () => {
            const n = document.getElementById('u-n').value.trim(), p = document.getElementById('u-p').value.trim();
            const s = await get(ref(db, 'users/'+n));
            if(s.exists() && s.val().password === p) { localStorage.setItem('mc_user', n); location.reload(); }
            else alert("–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ!");
        };

        window.logout = () => { localStorage.clear(); location.reload(); };
        window.clearDenied = () => { localStorage.removeItem('waiting_nick'); location.reload(); };

        const wNick = localStorage.getItem('waiting_nick');
        if(wNick && !curUser) {
            document.getElementById('auth-box').style.display = 'none';
            onValue(ref(db, 'pending_users/'+wNick), s => {
                const data = s.val();
                if(data) {
                    if(data.status === 'denied') {
                        document.getElementById('auth-wait').style.display = 'none';
                        document.getElementById('auth-denied').style.display = 'block';
                        document.getElementById('denied-msg').innerText = `–í–∞—à –∑–∞–ø–∏—Ç –±—É–ª–æ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º ${data.admin || '–°–∏—Å—Ç–µ–º–æ—é'}`;
                    } else {
                        document.getElementById('auth-wait').style.display = 'block';
                    }
                } else {
                    get(ref(db, 'users/'+wNick)).then(us => {
                        if(us.exists()) { localStorage.setItem('mc_user', wNick); localStorage.removeItem('waiting_nick'); location.reload(); }
                    });
                }
            });
        }

        onValue(ref(db, 'pending_users'), s => {
            const cont = document.getElementById('pending-list-render');
            const data = s.val() || {};
            cont.innerHTML = Object.entries(data).filter(([n, d]) => d.status !== 'denied').map(([n, d]) => `
                <div style="display:flex; align-items:center; justify-content:space-between; padding:15px; background:#111; margin-bottom:10px; border-radius:12px; border:1px solid #222;">
                    <b>${n}</b>
                    <div style="display:flex; gap:10px;">
                        <button class="btn-fancy" style="border-color:var(--green);" onclick="approveUser('${n}')">–°–•–í–ê–õ–ò–¢–ò</button>
                        <button class="btn-fancy" style="border-color:var(--red);" onclick="denyUser('${n}')">–í–Ü–î–•–ò–õ–ò–¢–ò</button>
                    </div>
                </div>`).join('');
        });

        window.approveUser = async (n) => {
            const s = await get(ref(db, 'pending_users/'+n));
            await set(ref(db, 'users/'+n), { nickname: n, password: s.val().password, roles: ['citizen'] });
            await remove(ref(db, 'pending_users/'+n));
        };

        window.denyUser = async (n) => {
            await update(ref(db, 'pending_users/'+n), { status: 'denied', admin: curUser });
        };

        if(curUser) {
            onValue(ref(db, 'users/'+curUser), s => {
                const u = s.val(); if(!u) return;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('p-nick').innerText = u.nickname;
                document.getElementById('p-nick').className = `nick-glow ${u.font || ''}`;
                document.getElementById('p-ava').src = `https://minotar.net/avatar/${u.nickname}`;
                const rs = Array.isArray(u.roles) ? u.roles : [u.roles || 'citizen'];
                document.getElementById('p-roles').innerHTML = rs.map(r => `<span class="role-tag ${R_MAP[r]?.c}">${R_MAP[r]?.n}</span>`).join('');
                if(rs.some(r => ['founder','admin','subfounder'].includes(r))) {
                    document.getElementById('adm-pending-btn').style.display = 'block';
                    document.getElementById('p-admin-tools').style.display = 'block';
                    document.getElementById('btn-adm-global').style.display = 'block';
                } else if(rs.includes('judge')) { document.getElementById('btn-adm-global').style.display = 'block'; }
            });
        }

       onValue(ref(db, 'users'), s => {
            const cont = document.getElementById('staff-render-box');
            const players = Object.values(s.val() || {});
            players.sort((a,b) => (R_MAP[b.roles?.[0]]?.p||0) - (R_MAP[a.roles?.[0]]?.p||0));
            cont.innerHTML = players.map(u => {
                const roles = Array.isArray(u.roles) ? u.roles : [u.roles || 'citizen'];
                return `<div class="player-card">
                    <img src="https://minotar.net/avatar/${u.nickname}">
                    <div>
                        <div class="nick-glow ${u.font||''}" style="font-size:20px; font-weight:900;">${u.nickname}</div>
                        <div>${roles.map(r=>`<span class="role-tag ${R_MAP[r]?.c || 'r-citizen'}">${R_MAP[r]?.n || '–ú–µ—à–∫–∞–Ω–µ—Ü—å'}</span>`).join('')}</div>
                    </div>
                </div>`;
            }).join('');
        });

        window.submitReport = async () => {
            const t = document.getElementById('rep-target').value, d = document.getElementById('rep-discord').value, de = document.getElementById('rep-desc').value;
            if(!t || !de) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–ø–∏—Å —Ç–∞ –Ω—ñ–∫!");
            await push(ref(db, 'reports'), { from: curUser, target: t, discord: d, desc: de, proof: document.getElementById('rep-proof').value, status: 'need' });
            alert("–°–∫–∞—Ä–≥—É –ø—Ä–∏–π–Ω—è—Ç–æ!"); toggleModal('m-justice-main', false);
        };

        window.openGlobalAdmin = () => { toggleModal('m-global-admin', true); renderGlobal('need'); };
        window.openMyReports = () => { toggleModal('m-my-reports', true); renderGlobal('my', curUser); };

        window.renderGlobal = async (cat, filter = null) => {
            const s = await get(ref(db, 'reports'));
            const reps = s.val() || {};
            const cont = filter ? document.getElementById('my-render-cont') : document.getElementById('global-render-cont');
            cont.innerHTML = "";
            Object.entries(reps).reverse().forEach(([id, r]) => {
                if(filter && r.from !== filter) return;
                if(!filter) {
                    if(cat === 'need' && r.status !== 'need') return;
                    if(cat === 'review' && r.status !== 'review') return;
                    if(cat === 'archive' && (r.status !== 'ok' && r.status !== 'no')) return;
                }
                cont.innerHTML += `<div style="background:#111; padding:20px; border-radius:15px; margin-bottom:15px; border:1px solid #333;">
                    <div class="status-banner ${S_CLASSES[r.status]}">${STATS[r.status]}</div>
                    <div style="font-size:12px; margin-bottom:8px;"><b>–í—ñ–¥:</b> ${r.from} | <b>–ù–∞:</b> ${r.target}</div>
                    <div style="color:#ccc; font-size:14px;">${r.desc}</div>
                    ${r.reason ? `<div style="margin-top:10px; color:var(--red);"><b>–í–µ—Ä–¥–∏–∫—Ç [${r.admin || '–°—É–¥–¥—è'}]:</b> ${r.reason}</div>` : ''}
                    ${!filter && (r.status === 'need' || r.status === 'review') ? `
                        <div style="display:flex; gap:10px; margin-top:15px;">
                            <button class="btn-fancy" onclick="updR('${id}','review')">–†–û–ó–ì–õ–Ø–î</button>
                            <button class="btn-fancy" style="border-color:var(--green);" onclick="updR('${id}','ok')">–°–•–í–ê–õ–ò–¢–ò</button>
                            <button class="btn-fancy" style="border-color:var(--red);" onclick="updR('${id}','no')">–í–Ü–î–•–ò–õ–ò–¢–ò</button>
                        </div>` : ''}
                </div>`;
            });
        };

        window.updR = async (id, st) => {
            let re = (st === 'no' || st === 'ok') ? prompt("–ö–æ–º–µ–Ω—Ç–∞—Ä:") : "";
            if(st === 'no' && !re) return alert("–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞!");
            await update(ref(db, `reports/${id}`), { status: st, admin: curUser, reason: re });
            renderGlobal(st === 'ok' || st === 'no' ? 'archive' : st);
        };

        window.setRole = () => {
            const n = document.getElementById('adm-target-nick').value, r = document.getElementById('adm-role-val').value;
            if(n) update(ref(db, 'users/'+n), { roles: [r] }).then(() => alert("–†–æ–ª—å –∑–º—ñ–Ω–µ–Ω–æ!"));
        };
        window.updateFont = (f) => update(ref(db, 'users/'+curUser), { font: f });

        const cvs=document.getElementById('snow-canvas'), ctx=cvs.getContext('2d'); let fs=[];
        function res(){ cvs.width=window.innerWidth; cvs.height=window.innerHeight; fs=[]; for(let i=0;i<80;i++) fs.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height, r:Math.random()*2+1, s:Math.random()*0.5+0.2}); }
        function drw(){ ctx.clearRect(0,0,cvs.width,cvs.height); ctx.fillStyle="rgba(255,255,255,0.2)"; ctx.beginPath(); fs.forEach(f=>{ ctx.moveTo(f.x,f.y); ctx.arc(f.x,f.y,f.r,0,Math.PI*2); f.y+=f.s; if(f.y>cvs.height)f.y=-5; }); ctx.fill(); requestAnimationFrame(drw); }
        res(); drw(); window.onresize=res;
        let mOn=false; window.playMusic=()=>{ if(!mOn){ const m=document.getElementById('bg-music'); m.volume=0.1; m.play(); mOn=true; } };

        // –ó–ê–•–ò–°–¢ (–¥–æ–¥–∞–Ω–æ –≤ –∫—ñ–Ω–µ—Ü—å –º–æ–¥—É–ª—è)
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.keyCode === 123 || (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83 || (e.shiftKey && (e.keyCode === 73 || e.keyCode === 74))))) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>
